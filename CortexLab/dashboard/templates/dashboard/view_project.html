{% extends 'main/dashboard_home.html' %}
{% load static %} 

{% block extra_css %}
<link rel="stylesheet" href="{% static 'dashboard/css/dashboard.css' %}">
{% endblock %}


{% block content %}
<div class="container">
    <!-- Sidebar -->
    <div class="sidebar">
        <h3>Actions</h3>
        
        <!-- Télécharger le dataset -->
        <form id="uploadForm" method="post" enctype="multipart/form-data" data-url="{% url 'dashboard:analyze_data' project.id %}">
            {% csrf_token %}
            <label for="file">Télécharger vos données :</label>
            <input type="file" id="file" name="file" accept=".csv, .xls, .xlsx" required>
            <button type="submit" class="button">Analyser le Dataset</button>
        </form>
        
        <!-- Section des colonnes détectées -->
        <div id="columnsSection" style="display: none;">
            <h3>Colonnes détectées :</h3>
            <ul id="columnsList"></ul>
        </div>

        <!-- Sélection du type de modèle -->
        <h3>Choisir un type de modèle</h3>
        <form id="modelTypeForm" method="post" data-url="{% url 'dashboard:set_model_type' project.id %}">
            {% csrf_token %}
            <select name="model_type" id="model_type" required>
                <option value="" disabled {% if not project.model_type %}selected{% endif %}>-- Sélectionnez un type de modèle --</option>
                <option value="clustering" {% if project.model_type == "clustering" %}selected{% endif %}>Clustering</option>
                <option value="regression" {% if project.model_type == "regression" %}selected{% endif %}>Régression</option>
                <option value="classification" {% if project.model_type == "classification" %}selected{% endif %}>Classification</option>
            </select>
            <button type="submit" class="button">Enregistrer le modèle</button>
        </form>
        
        <!-- Choisir les features -->
        <h3>Choisir les Features</h3>
        <form id="featuresForm" method="post" data-url="{% url 'dashboard:set_features' project.id %}">
            {% csrf_token %}
            <div id="featuresList">
                {% if project.columns %}
                    {% for column in project.columns %}
                        <input type="checkbox" name="features" value="{{ column.name }}" {% if column.name in project.features %}checked{% endif %}>
                        <label>{{ column.name|default:"Nom non défini" }}</label><br>
                    {% endfor %}
                {% else %}
                    <p>Aucune colonne disponible.</p>
                {% endif %}
            </div>
            <button type="submit" class="button">Définir les Features</button>
        </form>

        <!-- Choisir la target -->
        <h3>Choisir la Target</h3>
        <form id="targetForm" method="post" data-url="{% url 'dashboard:set_target' project.id %}">
            {% csrf_token %}
            <select name="target" id="target">
                {% if project.columns %}
                    {% for column in project.columns %}
                        <option value="{{ column.name }}" {% if project.target == column.name %}selected{% endif %}>
                            {{ column.name|default:"Nom non défini" }}
                        </option>
                    {% endfor %}
                {% else %}
                    <option value="" disabled>Aucune colonne disponible</option>
                {% endif %}
            </select>
            <button type="submit" class="button">Définir la Target</button>
        </form>
    </div>

    <!-- Vue principale -->
    <div class="content">
        <h2>Détails du Projet</h2>
        <p><strong>Nom du projet :</strong> {{ project.name }}</p>
        <p><strong>Type de modèle :</strong> {{ project.get_model_type_display|default:"Non défini" }}</p>

        <!-- Aperçu du dataset -->
        <h3>Aperçu du Dataset</h3>
        <div id="datasetPreview">
            {% if dataset_preview %}
                <table border="1">
                    <thead>
                        <tr>
                            {% for column in project.columns %}
                                <th>{{ column.name }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for row in dataset_preview %}
                        <tr>
                            {% for cell in row %}
                            <td>{{ cell }}</td>
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>Aucun dataset disponible.</p>
            {% endif %}
        </div>
        

        <!-- Résumé des actions -->
        <h3>Résumé</h3>
        <p><strong>Features sélectionnées :</strong> {{ project.features|default:"Aucune feature sélectionnée." }}</p>
        <p><strong>Target sélectionnée :</strong> {{ project.target|default:"Non définie" }}</p>
    </div>
</div>

<script src="{% static 'dashboard/js/dashboard.js' %}"></script>
{% endblock %}
